/**
* Version: 1.6
* Title: Eleditor 移动端富文本编辑器
* Site: https://eleditor.fixel.cn
* Author: Try
*/
(function(l){var c=false;var i="1.6";var d="Eleditor";var a=["INPUT","IMG","TEXTAREA"];var g={insertText:"插文字",insertImage:"插图片",insertLink:"插链接",insertHr:"水平线",deleteBefore:"删除前",deleteAfter:"删除后",editText:"改文字",deleteThis:"删除",undo:"撤销",cancel:"取消",};var j="";l[d]=function(){};if(typeof jQuery==="undefined"&&typeof Zepto==="undefined"){return console.warn("|--Eleditor 请引入jQuery或者Zepto！模块化环境请把依赖全局安装")}else{if(typeof h==="undefined"){var h=typeof jQuery!="undefined"?jQuery:Zepto}}var f=function(q){var p=document.scripts;p=p[p.length-1].src.substring(0,p[p.length-1].src.lastIndexOf("/")+1);q(p);return p}(function(p){var q='<link rel="stylesheet" href="'+p+"layout/base.css"+(c?"?v="+(+new Date()):"")+'">';h("head").append(q)});var m=function(r,p){for(var q in p){if(p[q]==r){return true}}return false};var o=function(p){var q=p.replace(/\ +/g,"");q=p.replace(/[ ]/g,"");q=p.replace(/[\r\n]/g,"");return q.replace(/(^\s*)|(\s*$)/g,"")};var b=function(){var p=Math.max.apply(null,h.map(h("body *"),function(r){var q=h(r);if(q.css("position")!="static"){return parseInt(q.css("z-index"))||1}}));return(p+"").indexOf("Infinity")>=0?1:p+1};var k=function(){return d+""+ +new Date};var e=function(){var q=arguments[0],p=arguments[1];if(o(q.text())==""&&q.find("img").length===0){q.append(p)}if(q.find("*").length===0){q.html('<p class="Eleditor-placeholder">'+q.html()+"</p>")}};var n=function(v,u){var r='<div class="Eleditor-wrap" style="z-index:'+b()+'" id="'+u+'">						<div class="Eleditor-controller">						<ul>';for(var t=0;t<v.length;t++){var w=v[t],s=typeof w==="object"?w.id:w,q=(typeof w==="object"&&w.tag)?w.tag.toLocaleLowerCase():null,p=typeof w==="object"?w.name:g[w];r+='<li event="'+s+'" '+(q?'bind-tags="'+q+'"':"")+' class="Eleditor-'+s+'">'+p+"</li>"}r+='		</ul>					</div>					<div class="Eleditor-loading"><p></p></div>					<div class="Eleditor-textEditor">						<div class="Eleditor-textStyle">							<div class="Eleditor-textStyle-item"><div class="Eleditor-textStyle-bold"></div></div>							<div class="Eleditor-textStyle-item"><div class="Eleditor-textStyle-color"><span></span></div></div>							<div class="Eleditor-textStyle-item"><div class="Eleditor-textStyle-linedecoration"></div></div>							<div class="Eleditor-textStyle-item"><div class="Eleditor-textStyle-bgColor"></div></div>							<div class="Eleditor-textStyle-item"><div class="Eleditor-textStyle-fontSize"></div></div>							<div class="Eleditor-textStyle-item"><div class="Eleditor-textStyle-lineHeight"></div></div>							<div class="Eleditor-textStyle-item">								<div class="Eleditor-textStyle-align Eleditor-textStyle-alignLeft" align="left"></div>							</div>							<div class="Eleditor-textStyle-item">								<div class="Eleditor-textStyle-align Eleditor-textStyle-alignCenter" align="center">								</div>							</div>							<div class="Eleditor-textStyle-item">								<div class="Eleditor-textStyle-align Eleditor-textStyle-alignRight" align="right">								</div>							</div>							<div class="Eleditor-textStyle-item Eleditor-textStyle-item-upImg">								<div class="Eleditor-textStyle-upImg"></div>							</div>						</div>						<div class="Eleditor-textEditor-colors">							<div class="Eleditor-textEditor-modulePane"><span></span></div>							<ul>								<li><span style="background-color:#232323;"></span></li>								<li><span style="background-color:#2196F3;"></span></li>								<li><span style="background-color:#795548;"></span></li>								<li><span style="background-color:#00BCD4;"></span></li>								<li><span style="background-color:#4CAF50;"></span></li>								<li><span style="background-color:#E666E5;"></span></li>								<li><span style="background-color:#FF9800;"></span></li>								<li><span style="background-color:#FF5722;"></span></li>								<li><span style="background-color:#ff2a1a;"></span></li>								<li><span style="background-color:#FFEB3B;"></span></li>								<li><span style="background-color:#ffffff;border: 1px solid #ccc;"></span></li>								<li>									<span class="Eleditor-inheritValue" style="background-color:transparent; border: 1px solid #dedede;">									</span>								</li>							</ul>						</div>						<div class="Eleditor-textEditor-fontsizes">							<div class="Eleditor-textEditor-modulePane"><span>字体大小</span></div>							<ul>								<li class="Eleditor-inheritValue">默认</li>								<li>14px</li>								<li>16px</li>								<li>20px</li>								<li>28px</li>								<li>35px</li>							</ul>						</div>						<div class="Eleditor-textEditor-lineheight">							<div class="Eleditor-textEditor-modulePane"><span>行高</span></div>							<ul>								<li class="Eleditor-inheritValue">默认</li>								<li>20px</li>								<li>25px</li>								<li>30px</li>								<li>35px</li>								<li>40px</li>							</ul>						</div>						<div class="Eleditor-textEditor-linedecorations">							<div class="Eleditor-textEditor-modulePane"><span>文本修饰</span></div>							<ul>								<li class="Eleditor-inheritValue">无</li>								<li style="text-decoration: overline">上划线修饰</li>								<li style="text-decoration: line-through">删除线修饰</li>								<li style="text-decoration: underline">下划线修饰</li>							</ul>						</div>						<div class="Eleditor-textEditor-formats">							<div class="Eleditor-textEditor-format"></div>							<div class="Eleditor-textEditor-clean"></div>						</div>						<div class="Eleditor-inputarea">							<input placeholder="请输入超链接" type="text" />							<div class="textarea" contenteditable="true"></div>						</div>						<div class="Eleditor-method">							<button class="Eleditor-commit">提交</button>							<button class="Eleditor-cancel">取消</button>						</div>					</div>				</div>';
return r};l[d]=function(){console.log("|--Eleditor Initing");var E=arguments[0];E.upload=E.upload||{};E.toolbars=E.toolbars||[],_editorUid=k(),_historys=[],_placeHolder=E.placeHolder||'<p class="Eleditor-placeholder">点击此处编辑内容</p>';if(E.toolbars.length===0){E.toolbars=["insertText","editText","insertImage","insertLink","deleteBefore","deleteAfter","insertHr","deleteThis","undo","cancel",]}if(E.el instanceof jQuery){var u=E.el}else{var u=h(E.el);if(u.length===0){return console.warn("|--Eleditor "+E.el+"元素不存在，请在DOMContentLoaded后初始化Eleditor")}else{if(u.length!=1){var u=h(u[0])}}}if(u.attr("Eleditor-Inited")==="true"){return console.warn("|--Eleditor "+E.el+"已经绑定了Eleditor")}u.attr({"Eleditor-Inited":"true","Eleditor-Uid":_editorUid});e(u,_placeHolder);var K=null;var W=h(l);var U=h("html,body");var F=h(n(E.toolbars,_editorUid));var N=F.find(".Eleditor-controller");var x=F.find(".Eleditor-loading");var p=F.find(".Eleditor-textEditor");var S=p.find(".Eleditor-inputarea .textarea");var J=N.find(".Eleditor-insertImage");var I=p.find(".Eleditor-textStyle-item-upImg");var D=p.find(".Eleditor-inputarea input");var R=p.find(".Eleditor-textEditor-colors");var v=p.find(".Eleditor-textEditor-fontsizes");var L=F.find(".Eleditor-undo");var H=p.find(".Eleditor-textEditor-lineheight");var C=p.find(".Eleditor-textEditor-linedecorations");u.addClass("Eleditor-area");u.after(F);console.log("|--Eleditor Mounted To",u);var w=null,B=null,Q=null;var r=function(Y){w=Y;Y.addClass("Eleditor-active");var X=Y.offset().top+Y.outerHeight();h.each(N.find("li"),function(aa,ac){var ab=h(ac),Z=ab.attr("bind-tags");if(Z){Z=Z.toLocaleLowerCase().split(",");if(m(w[0].tagName.toLocaleLowerCase(),Z)){ab.show()}else{ab.hide()}}});N.show();A();if(typeof U.animate==="function"){U.stop().animate({scrollTop:(X-150)+"px"},500)}else{U.scrollTop((X-150)+"px")}B&&B.refresh()};var A=function(){if(w){N.css({top:w.offset().top+w.outerHeight(),width:u.width()-5})}};var z=function(){u.find(".Eleditor-active").removeClass("Eleditor-active");N.hide()};var T=function(){if(m("insertImage",E.toolbars)){I.show()}N.hide();F.addClass("Eleditor-mask");K=W.scrollTop();U.addClass("Eleditor-scrollLocked")};var s=function(){F.removeClass("Eleditor-mask");U.removeClass("Eleditor-scrollLocked");W.scrollTop(K)};var M=function(){T();x.show();x.html("<p>"+arguments[0]+"</p>")};var y=function(){_historys.push(arguments[0]);t()};var P=function(){if(_historys.length===0){return}var X=_historys.pop();if(X.m=="insertNode"){X.node.remove()}if(X.m=="editNode"){X.node.attr("style",X.unode.attr("style")||"").html(X.unode)}if(X.m=="deleteNode"){if(X.pnode.length>0){X.pnode.after(X.node)}else{u.prepend(X.node)}u.find(".Eleditor-placeholder").remove()}if(X.m=="deleteBeforeNode"){for(var Y=X.bnode.length-1;Y>=0;Y--){X.node.before(X.bnode[Y])}}if(X.m=="deleteAfterNode"){X.node.after(X.anode)}t()};var t=function(){if(_historys.length==0){L.hide()}else{L.show()}};var q=function(){s();x.hide()};var G=function(){p.attr("role","edit").show();S.html(w.hasClass("Eleditor-placeholder")?"":w.html());S.attr("style",w.attr("style"));if(w.css("font-weight")=="bold"){p.find(".Eleditor-textStyle-bold").addClass("Eleditor-active")}if(m(w.css("text-decoration"),["overline","line-through","underline"])){p.find(".Eleditor-textStyle-linedecoration").addClass("Eleditor-active")}if(w[0].tagName=="A"){p.attr("type","link");D.val(w.attr("href"))}else{p.attr("type","word")}var X=w.css("text-align");if(m(X,["left","center","right"])){p.find(".Eleditor-textStyle-align[align="+X+"]").addClass("Eleditor-active")}else{p.find(".Eleditor-textStyle-align").removeClass("Eleditor-active")}p.find(".Eleditor-textStyle-color span").css("background-color",w.css("color"))};if(m("insertImage",E.toolbars)&&typeof WebUploader!="undefined"){B=WebUploader.create({auto:true,server:E.upload.server||"/upload",pick:J,duplicate:true,resize:false,compress:false,fileSingleSizeLimit:E.upload.fileSizeLimit?E.upload.fileSizeLimit*1024*1024:undefined,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png,webp",mimeTypes:"image/gif,image/jpg,image/jpeg,image/bmp,image/png,image/webp"}});B.on("uploadStart",function(X,Y){z();M('上传图片中<span id="uploadProgress">1</span>%')});B.on("uploadProgress",function(X,Y){h("#uploadProgress").html(parseFloat((Y*100).toFixed(2)))});B.on("error",function(){if(arguments[0]=="Q_TYPE_DENIED"){alert("请上传图片格式文件")}if(arguments[0]=="F_EXCEED_SIZE"){alert("文件大小不能超过"+(arguments[1]/1048576)+"M")}});B.on("uploadComplete",function(){q()});B.on("uploadSuccess",function(Y,Z){if(Z.status==1){var X=h('<img src="'+Z.url+'">');w.after(X);y({m:"insertNode",node:X})}else{alert(Z.msg)}});Q=WebUploader.create({auto:true,server:E.upload.server||"/upload",pick:I,duplicate:true,resize:false,fileSingleSizeLimit:E.upload.fileSizeLimit?E.upload.fileSizeLimit*1024*1024:undefined,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png,webp",mimeTypes:"image/gif,image/jpg,image/jpeg,image/bmp,image/png,image/webp"}});Q.on("uploadStart",function(X,Y){M('上传图片中<span id="uploadProgress">1</span>%')
});Q.on("uploadProgress",function(X,Y){h("#uploadProgress").html(parseFloat((Y*100).toFixed(2)))});Q.on("error",function(){if(arguments[0]=="Q_TYPE_DENIED"){alert("请上传图片格式文件")}if(arguments[0]=="F_EXCEED_SIZE"){alert("文件大小不能超过"+(arguments[1]/1048576)+"M")}});Q.on("uploadComplete",function(){q()});Q.on("uploadSuccess",function(X,Y){if(Y.status==1){S.append('<img src="'+Y.url+'">')}else{alert(Y.msg)}})}var V={insertText:function(){T();p.attr({"role":"insert","type":"word"}).show()},insertLink:function(){T();p.attr({"role":"insert","type":"link"}).show()},insertImage:function(){if(typeof WebUploader==="undefined"){alert("图片上传请手动引入插件根目录webuploader.min.js")}},insertHr:function(){var X=h('<div class="horizontal-line" style="padding: 10px 0;border-bottom: 1px solid #aaa;margin-bottom: 20px;"></div>');w.after(X);y({m:"insertNode",node:X});z()},editText:function(){if(m(w[0].tagName,a)){return this.insertText()}T();G()},deleteThis:function(){y({m:"deleteNode",node:w,pnode:w.prev()});w.remove();z();e(u,_placeHolder)},deleteBefore:function(){var Z=w.prev();y({m:"deleteBeforeNode",node:w,bnode:w.prevAll()});var X;while(Z.length>0){X=Z.prev();Z.remove();Z=X}var Y=w.parent();while(Y.length>0&&!Y.hasClass("Eleditor-area")){Z=Y.prev();while(Z.length>0){X=Z.prev();Z.remove();Z=X}Y=Y.parent()}z();e(u,_placeHolder)},deleteAfter:function(){var Y=w.next();y({m:"deleteAfterNode",node:w,anode:w.nextAll()});var Z;while(Y.length>0){Z=Y.next();Y.remove();Y=Z}var X=w.parent();while(X.length>0&&!X.hasClass("Eleditor-area")){Y=X.next();while(Y.length>0){Z=Y.next();Y.remove();Y=Z}X=X.parent()}z();e(u,_placeHolder)},undo:function(){P();z()},cancel:function(){z()}};for(var O=0;O<E.toolbars.length;O++){if(typeof E.toolbars[O]==="object"){V[E.toolbars[O].id]=E.toolbars[O].handle}}W.on("resize",function(){A()});N.on("click","ul li",function(){var Y=h(this),X=Y.attr("event");if(typeof V[X]==="function"){if(typeof g[X]!="undefined"){V[X]()}else{V[X](w,Y)!==false&&V.cancel()}}});p.on("click",".Eleditor-textStyle-bold",function(){S.css("font-weight",h(this).hasClass("Eleditor-active")?"normal":"bold");h(this).toggleClass("Eleditor-active")});p.on("click",".Eleditor-textStyle-linedecoration",function(){C.show();h(this).addClass("Eleditor-active")});p.on("click",".Eleditor-textStyle-color,.Eleditor-textStyle-bgColor",function(){var X=h(this);var Y=X.hasClass("Eleditor-textStyle-bgColor")?"bgcolor":"color";R.find(".Eleditor-textEditor-modulePane span").html(Y=="bgcolor"?"文字背景颜色":"文字颜色");R.attr("role",Y).show();h(this).addClass("Eleditor-active")});p.on("click",".Eleditor-textStyle-fontSize",function(){v.show();h(this).addClass("Eleditor-active")});p.on("click",".Eleditor-textStyle-lineHeight",function(){H.show();h(this).addClass("Eleditor-active")});C.on("click","ul li",function(){if(!h(this).hasClass("Eleditor-inheritValue")){S.css("text-decoration",h(this).css("text-decoration"))}else{S.css("text-decoration","inherit");p.find(".Eleditor-textStyle-linedecoration").removeClass("Eleditor-active")}C.hide()});H.on("click","ul li",function(){if(!h(this).hasClass("Eleditor-inheritValue")){S.css("line-height",h(this).html())}else{S.css("line-height","inherit");p.find(".Eleditor-textStyle-lineHeight").removeClass("Eleditor-active")}H.hide()});v.on("click","ul li",function(){if(!h(this).hasClass("Eleditor-inheritValue")){S.css("font-size",h(this).html())}else{S.css("font-size","inherit");p.find(".Eleditor-textStyle-fontSize").removeClass("Eleditor-active")}v.hide()});p.on("click",".Eleditor-textStyle-align",function(){var X=h(this).attr("align");S.css({"text-align":X,"display":"block"});p.find(".Eleditor-textStyle-align.Eleditor-active").removeClass("Eleditor-active");h(this).addClass("Eleditor-active")});p.on("click",".Eleditor-textEditor-format",function(){var Y=S,X="style width height border bgcolor align color";Y.removeAttr(X);h.each(Y.find("*"),function(ab,Z){var aa=Y.find(Z);if(m(Z.tagName.toLocaleLowerCase(),["script","style"])){aa.remove()}else{aa.removeAttr(X)}});S.html(Y.html());p.find(".Eleditor-active").removeClass("Eleditor-active")});p.on("click",".Eleditor-textEditor-clean",function(){confirm("确定清空内容（不可恢复）？")&&S.html("")});p.on("click",".Eleditor-cancel,.Eleditor-commit",function(){arguments[0].preventDefault();if(h(this).hasClass("Eleditor-commit")){var X=S.attr("style")||"";var Z=S.html();var ab=w.clone();if(!Z){return alert("请输入内容文字")}if(p.attr("role")=="edit"||w.hasClass("Eleditor-placeholder")){if(p.attr("type")=="link"){var aa=D.val();w.attr("href",aa)}w.attr("style",X).removeClass("Eleditor-placeholder").html(Z);y({m:"editNode",node:w,unode:ab});A()}else{var Y="";if(p.attr("type")=="link"){var aa=D.val();Y='<a target="_BLANK" style="'+X+'" href="'+aa+'">'+Z+"</a>"}else{Y='<p style="'+X+'">'+Z+"</p>"}var Y=h(Y);w.after(Y);A();y({m:"insertNode",node:Y})}}p.find(".Eleditor-active").removeClass("Eleditor-active");p.find(".Eleditor-textStyle-color span").removeAttr("style");S.removeAttr("style").html("");D.val("");s();p.hide();z()});R.on("click","ul li span",function(){var X=h(this).css("background-color");
if(R.attr("role")=="color"){if(!h(this).hasClass("Eleditor-inheritValue")){S.css("color",X);p.find(".Eleditor-textStyle-color span").css("background-color",X)}else{S.css("color","inherit");p.find(".Eleditor-textStyle-color").removeClass("Eleditor-active").find("span").removeAttr("style")}}else{if(!h(this).hasClass("Eleditor-inheritValue")){S.css("background-color",X)}else{S.css("background-color","inherit");p.find(".Eleditor-textStyle-bgColor").removeClass("Eleditor-active")}}R.hide()});u.on("click","*",function(X){var Y=h(this);if(!Y.hasClass("Eleditor-active")){z();r(Y)}return X.preventDefault()==0});return{append:function(){u.find(".Eleditor-placeholder").remove();return u.append(arguments[0])},getEditNode:function(){if(w===null){console.warn("未选中状态getEditNode返回null")}return w},getContent:function(){return u.html()},getContentText:function(){return o(u.text())},destory:function(){u.removeAttr("Eleditor-Inited Eleditor-Uid");u.removeClass("Eleditor-area");u.find(".Eleditor-placeholder").remove();u.off().find(".Eleditor-active").removeClass("Eleditor-active");F.find("*").off();F.remove();console.log("|--Eleditor "+_editorUid+" destoryed")}}}})(window);